---
title: DataV实践：创建迪士尼乐园实况大屏
date: 2017-12-25
tags: [DataV, Disney, JavaScript]
categories: [数据可视化]
---

<img src="https://user-gold-cdn.xitu.io/2017/12/24/160870e325f5b11f?w=2304&h=1293&f=jpeg&s=231206" class="full-image"/>
一块大屏能实时显示迪士尼乐园的情况

<!--more-->

![](https://user-gold-cdn.xitu.io/2017/12/24/16086c522afa9bd2?w=1800&h=1200&f=jpeg&s=397162)
我是一个迪士尼乐园的爱好者，我想拥有一块大屏能实时显示迪士尼乐园的情况，以便我觉得今天去不去乐园，去乐园玩什么项目。。。

## 数据来源

我写了一个抓包的程序，每天获取一次乐园运营数据（项目开放时间，状态灯），每 5 分钟获取一次乐园实况数据（排队时间、客流量等）

![](https://user-gold-cdn.xitu.io/2017/12/24/16086c5f7605e54b?w=1744&h=1005&f=jpeg&s=203216)

> 现在用的还是 Mysql 存储，计划转 Redius，运行了快一年了，数据量太大性能越来越差~

## 关于 DataV

![](https://user-gold-cdn.xitu.io/2017/12/24/16086c697900318d?w=2000&h=953&f=jpeg&s=34043)
DataV 是阿里云出品的一款数据可视化应用，可以通过图形可视化的界面快速搭建专业旨让更多的人看到数据可视化的魅力。

![](https://user-gold-cdn.xitu.io/2017/12/24/16086d09664636f8?w=630&h=391&f=jpeg&s=97872)
一般应用在交易大厅，展览中心，管控中心，老板办公室等等场景，把一些关键数据集中展示在一块巨大的 LED 屏幕上，**其实就是巨大化的 Dashboard**，是当今数一数二的装逼方式！

## 开始制作

进入[https://datav.aliyun.com]()官网。我购买的是基础版，51 一年，不是很贵，功能对当前需求够用。
![](https://user-gold-cdn.xitu.io/2017/12/24/16086988c76176b5?w=1380&h=2120&f=png&s=93043)

### 布局规划

![](https://user-gold-cdn.xitu.io/2017/12/24/16086b7f780aa097?w=1280&h=800&f=jpeg&s=140667)
可以先借助草图工具规划一下：

1.  顶部设计：因为是实时大屏，时间必不可少，顶部为时间 - 标题 - Logo 的布局
2.  左侧设计：乐园客流量趋势，乐园主题园区热度，显示乐园和各个主题园区的热门情况
3.  中间设计：上部分为轮播所有项目的等待时间+演出项目的时间表，下部分用柱状图显示核心项目的排队时间
4.  右侧设计：乐园平均等待时间 + 热门项目等待时间 + 乐园指数，显示乐园整体和热门项目的情况

### 选择模板

![](https://user-gold-cdn.xitu.io/2017/12/24/16086c862814752b?w=2604&h=1754&f=jpeg&s=271245)
DataV 提供了多套模板针对不同的场景，这里第一个就非常适合这一套项目

选择**创建大屏**进入编辑界面

### 顶部制作

![](https://user-gold-cdn.xitu.io/2017/12/24/16086d3cbcd1b55b?w=659&h=1097&f=jpeg&s=65317)

![](https://user-gold-cdn.xitu.io/2017/12/24/16086eff0846eecd?w=1735&h=121&f=jpeg&s=15940)
选择辅助图形 - 添加时间器，再给标题加个边框，再加个 Logo，2 分钟完成！

### 左侧制作

![](https://user-gold-cdn.xitu.io/2017/12/24/16086f1138485afc?w=500&h=337&f=jpeg&s=11041)

**实施客流量：**

选择一个线框图或者新建一个

![](https://user-gold-cdn.xitu.io/2017/12/24/16086dd18e54d4b8?w=780&h=910&f=jpeg&s=45439)

然后进入图表设置，选择**数据**这里我们使用 Api，

> 这里的 Api 必须返回的必须是直接数据，如{data:{},result:1} 这样就不行

下面这是我们从服务器读到的数据

```json
[
  {
    "num": 10730,
    "utime": "08:30"
  },
  {
    "num": 10730,
    "utime": "08:45"
  }...
]
```

然后我们进行字段映射，将 x(x 轴)匹配为 utime，y（y 轴）匹配为 num（数值）这样图表就更新了！

![](https://user-gold-cdn.xitu.io/2017/12/24/16086ee74faa95bc?w=560&h=65&f=png&s=3540)
我们还可以设置**自动更新**定时刷新图表

进入样式设置：可对图表进行个性化定制，这些基本上手就会我就不一一说明了，这里重点说下数据配置->数据增量这个设置，这个勾选后可将数据进行截取一部分，比如说我的 api 返回的是当前一天的数据流，我的图表只要最近**3 小时**，则可以设置**最大容量**进行截取

**主题园区热度：**

![](https://user-gold-cdn.xitu.io/2017/12/24/16086fe699c8c897?w=498&h=473&f=jpeg&s=27702)

这个图表反应各个园区的热度 ，展示的就是每个主题园区所有项目的排队时间总和

选择常规图表->柱状图->胶囊图

![](https://user-gold-cdn.xitu.io/2017/12/24/16086fd8fe3670e2?w=472&h=226&f=jpeg&s=9511)
数据配置和上图一样，这里字段映射需要增加一个类目（就是每个项目包含的哪个主题园区）

进入样式设置：在数据系列中设置下每个项目的不同的颜色

![](https://user-gold-cdn.xitu.io/2017/12/24/16087008b1c92907?w=477&h=732&f=jpeg&s=28081)

### 中间制作

**等待时间/演出时间表**

![](https://user-gold-cdn.xitu.io/2017/12/24/160870182ebc23f4?w=798&h=537&f=jpeg&s=37970)

选择文字->轮播列表新建

![](https://user-gold-cdn.xitu.io/2017/12/24/1608702d8a80b52e?w=818&h=392&f=jpeg&s=27683)

数据配置同上，但这里不需要进行字段映射
![](https://user-gold-cdn.xitu.io/2017/12/24/1608704b59ee0654?w=477&h=730&f=jpeg&s=31457)

```json
\\数据响应结果
[
  {
    "name": "翱翔•飞越地平线",
    "id": "attSoaringOverHorizon",
    "start_time": "8:00",
    "end_time": "20:30",
    "status": "Operating",
    "type": 2,
    "fpTime": 0,
    "postedWaitMinutes": 180,
    "fastPassStartTime": 0,
    "fastPass": 1,
    "is_host": 1,
    "lng": "121.6717021420",
    "lat": "31.1498546788",
    "mapShow": false,
    "disance": 0
  },...
]
```

进入样式设置，选择自定义列可配置需要展示的数据，这里只要添加两项，名称和排队时间

![](https://user-gold-cdn.xitu.io/2017/12/24/16087088976cedbb?w=466&h=1083&f=jpeg&s=36340)

> 演出时间表的配置和项目等待时间一样

然后在下面创建一个等待时间垂直柱状图，这样可以更直观的显示哪个项目人数最多，配置同上

![](https://user-gold-cdn.xitu.io/2017/12/24/160870a4fc43d615?w=805&h=319&f=jpeg&s=26991)

### 右侧制作

![](https://user-gold-cdn.xitu.io/2017/12/24/160870cf9930a154?w=404&h=821&f=jpeg&s=28320)

右侧的制作和左侧一样，就不一一讲解了。

### 完成效果

![](https://user-gold-cdn.xitu.io/2017/12/24/160870e325f5b11f?w=2304&h=1293&f=jpeg&s=231206)

![](https://user-gold-cdn.xitu.io/2017/12/24/160871087ab0af8d?w=1440&h=1080&f=jpeg&s=202163)

附上我的小书房，这下抬头就可以看到乐园的实况，是不是很方便呢！

![](https://user-gold-cdn.xitu.io/2017/12/24/1608713f10904bce?w=234&h=543&f=jpeg&s=42132)
附上我的微信，欢迎喜欢迪士尼和前后端的一起交流！
